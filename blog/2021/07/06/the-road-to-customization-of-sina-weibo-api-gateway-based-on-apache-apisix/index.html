<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-K24PRPS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-K24PRPS",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX® -- Cloud-Native API Gateway" href="/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/articles/rss.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/articles/atom.xml" title="Apache APISIX® -- Cloud-Native API Gateway Blog Atom Feed"><title data-react-helmet="true">The Road to Customized Development of Sina Weibo API Gateway | Apache APISIX® -- Cloud-Native API Gateway</title><meta data-react-helmet="true" property="og:image" content="https://static.apiseven.com/202202/apache-apisix.png"><meta data-react-helmet="true" name="twitter:image" content="https://static.apiseven.com/202202/apache-apisix.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix"><meta data-react-helmet="true" name="docsearch:language" content="en"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="default"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="The Road to Customized Development of Sina Weibo API Gateway | Apache APISIX® -- Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="Sina Weibo’s previous HTTP API gateway was built based on Nginx, which brought up a series of problems. After some research, we chose Apache APISIX, which is dynamic, efficient and stable to meet the fast response requirements of the business."><meta data-react-helmet="true" property="og:description" content="Sina Weibo’s previous HTTP API gateway was built based on Nginx, which brought up a series of problems. After some research, we chose Apache APISIX, which is dynamic, efficient and stable to meet the fast response requirements of the business."><meta data-react-helmet="true" name="keywords" content="Apache APISIX,Sina,Weibo,Usser Case,API Gateway"><meta data-react-helmet="true" property="og:type" content="article"><meta data-react-helmet="true" property="article:published_time" content="2021-07-14T00:00:00.000Z"><meta data-react-helmet="true" property="article:tag" content="User Case"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/zh/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/runtime~main.f3244aab.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/assets/js/main.86bd6361.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/assets/css/styles.355196a5.css">

<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_QVmC">Skip to main content</a></div><div class="announcementBar_gVRT" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_csWV"></div><div class="announcementBarContent_2kKG">🤔 Have queries regarding API Gateway? Join Slack channel to discuss <a target="_blank" rel="noopener noreferrer" href="/docs/general/join">join #apisix channel</a>! ⭐️</div><button type="button" class="clean-btn close announcementBarClose_EDEK" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_IWhJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo2.svg" alt="Apache APISIX®" class="themedImage_3EHU themedImage--light_heW6 navbar__logo"><img src="/img/logo2.svg" alt="Apache APISIX®" class="themedImage_3EHU themedImage--dark_6pZL navbar__logo"><b class="navbar__title">Apache APISIX®</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs">Docs</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/apisix/getting-started">Apache APISIX®️</a></li><li><a class="dropdown__link" href="/docs/dashboard/USER_GUIDE">Apache APISIX®️ Dashboard</a></li><li><a class="dropdown__link" href="/docs/ingress-controller/getting-started/">Apache APISIX®️ Ingress Controller</a></li><li><a class="dropdown__link" href="/docs/helm-chart/apisix/">Apache APISIX®️ Helm Charts</a></li><li><a class="dropdown__link" href="/docs/docker/build/">Apache APISIX®️ Docker</a></li><li><a class="dropdown__link" href="/docs/java-plugin-runner/development/">Apache APISIX®️ Java Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/go-plugin-runner/getting-started/">Apache APISIX®️ Go Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/python-plugin-runner/getting-started/">Apache APISIX®️ Python Plugin Runner</a></li><li><a class="dropdown__link" href="/docs/general/join">General</a></li></ul></div><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a class="navbar__item navbar__link" href="/blog/tags/user-case">Case Studies</a><a class="navbar__item navbar__link" href="/downloads">Downloads</a><a class="navbar__item navbar__link" href="/help">Help</a><a class="navbar__item navbar__link" href="/team">Team</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Resources</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/showcase">Showcase</a></li><li><a class="dropdown__link" href="/plugins">PluginHub</a></li><li><a class="dropdown__link" href="/docs/general/join">Community</a></li><li><a class="dropdown__link" href="/docs/general/events">Events</a></li></ul></div><div class="react-toggle toggle_pM6S react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_5Cll">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_5Cll">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_xkIr"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_drON thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_+zDs margin-bottom--md">All posts</div><ul class="sidebarItemList_L38e"><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/06/21/weekly-report-0621">Biweekly Report (Jun 1 - Jun 15)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/06/14/automated-operation-base-apache-apisix">Build automated operation platform based on Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/06/14/beeto-with-apache-apisix">Practice of localized application with API gateway in the Middle East</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/06/14/how-mse-supports-canary-release-with-apache-apisix">Implementation of canary release solution based on Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/06/14/xueqiu-with-apache-apisix">Architecture evolution of investment platforms with API gateway</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/06/07/installation-performance-test-of-apigateway-apisix-on-aws-graviton3">Installation and performance testing of API Gateway Apache APISIX on AWS Graviton3</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/06/07/weekly-report-0607">Biweekly Report｜Explore the weeks of May 16th - May 31th</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/05/31/release-apache-apisix-2.14">Release Apache APISIX 2.14.1</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/05/19/weekly-report-0519">Biweekly Report (May 1 - May 15)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/05/10/weekly-report-0510">Biweekly Report (Apr 15 - Apr 30)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/04/29/interview-juzhiyuan-apache-member">Interview with JU Zhiyuan: Becoming One of the 918 ASF Members, I Felt Thrilled and Proud</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/04/22/apisix-with-tidb-practice">High Availability Configuration with TiDB and APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/04/20/cve-2022-29266">The Vulnerability of Leaking Information in Error Response from jwt-auth Plugin（CVE-2022-29266）</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/04/20/weekly-report-0420">Biweekly Report (Apr 1 - Apr 14)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/04/17/api-observability">API Observability with APISIX Plugins</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/04/12/apisix-summit-asia-2022">Apache APISIX Summit ASIA 2022: API Gateway, Service Mesh and Open Source Ecology</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/28/release-apache-apisix-2.13">Apache APISIX 2.13.0 Is Released, Bringing LTS and New Features</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/24/weekly-report-0314">Biweekly Report｜Explore the weeks of Mar 1st - Mar 14th</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/05/apisix-integration-eureka-service-discovery">Integrate API Gateway with Eureka</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/04/apigateway-clickhouse-makes-logging-easier">APISIX Integrates ClickHouse to Improve Log Efficiency</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/04/apisix-uses-coredns-enable-service-discovery">Apache APISIX and CoreDNS open new doors for service discovery</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/03/develop-apisix-with-gitpod">How to Use Gitpod to Develop API Gateway?</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/03/weekly-report-0228">Biweekly Report｜Explore the week of Feb 15 - Feb 28</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/02/apisix-integration-graphql-plugin">Use GraphQL with API Gateway Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/02/zhongan-usercase-with-apache-apisix">Implement Traffic Governance in Internet Insurance with APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/03/01/apisix-integration-public-api-plugin">API Gateway Apache APISIX provides enhancements on API Management</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/28/apisix-integration-opentelemetry-plugin">Upgrade of observability capabilities, API Gateway Apache APISIX integrates OpenTelemetry</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/25/consul-api-gateway">How to Integrate API Gateway and Consul?</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/23/csrf-api-gateway">API Gateway Enhances Security by CSRF Plugin</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/21/nacos-api-gateway">The practice of Nacos service discovery on API Gateway</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/17/weekly-report-0214">Biweekly Report (Feb 1 - Feb 14)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/16/file-logger-api-gateway">file logger practice in API Gateway</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/11/cve-2022-24112">Apache APISIX Vulnerability for Rewriting X-REAL-IP Header (CVE-2022-24112)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/02/10/splunk-apisix-integration">Integrating Splunk HTTP Event Collector with API Gateway</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/26/apisix-integrate-forward-auth-plugin">forward-auth Plugin for Authentication Function</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/25/apisix-grpc-web-integration">Integrate Apache APISIX with gRPC-Web</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/25/release-apache-apisix-2.12">Apache APISIX 2.12.0 is Released, More Features Coming！</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/24/apisix-with-qingcloud-meetup">Webinar | APISIX in QingCloud! </a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/21/apisix-hashicorp-vault-integration">HashiCorp Vault Secure Storage Backend in Apache APISIX Ecosystem</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/21/apisix-xrpc-details-and-miltilingual">Get More Details About xRPC</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/20/upyun-public-gateway-usecase">The Practice of Public Gateway in CDN Scenario from UPYUN</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/19/weekly-report-0116">Biweekly Report (Jan 1 - Jan 16)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/17/apisix-kafka-integration">APISIX integrate with Kafka for real-time log monitoring</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/13/how-to-proxy-dubbo-in-apache-apisix">Makes it More Convenient for You to Proxy Dubbo Services in Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/11/apisix-with-shardingsphere-meetup">Webinar | From API to Database</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/11/building-apisix-in-ubuntu-for-arm">How to build APISIX in ARM Ubuntu</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/05/weekly-report-1231">Biweekly Report (Dec 16 - Dec 31)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2022/01/04/authing">Use APISIX and Authing to implement centralized authentication Management</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/30/apisix-proxy-grpc-service">Use API gateway to proxy gRPC service</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/28/dashboard-cve-2021-45232">Apache APISIX Dashboard Unauthorized Access Vulnerability Announcement (CVE-2021-45232)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/24/apisix-integrate-openwhisk-plugin">Coming soon! Apache APISIX Integrate with Apache OpenWhisk</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/24/open-policy-agent">Apache APISIX integrates with Open Policy Agent</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/22/google-logging">APISIX Integrates with Google Cloud Logging</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/20/weekly-report-1215">Biweekly Report (Dec 1 - Dec 15)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/17/exposure-istio-with-apisix-ingress">Secure Exposure of Istio Services with APISIX Ingress</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/16/apisix-with-rocketmq-meetup">Webinar | Apache APISIX × Apache RocketMQ Online Meetup</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/15/deploy-apisix-in-kubernetes">How to Easily Deploy Apache APISIX in Kubernetes</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/13/monitor-apisix-ingress-controller-with-prometheus">Monitor APISIX Ingress Controller with Prometheus</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/10/integrate-keycloak-auth-in-apisix">How to Integrate Keycloak for Authentication with Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/08/apisix-integrate-rocketmq-logger-plugin">Apache APISIX &amp; RocketMQ Help API Log Monitoring Capabilities</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/07/apisix-integrate-skywalking-plugin">Apache APISIX Integrates with SkyWalking to Create a Full Range of Log Processing</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/02/weekly-report-1130">Biweekly Report｜11.15-11.30 Feature Highlights Update in Progress</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/01/apisix-supports-azure-functions">Apache APISIX&#x27;s integration with Azure Serverless</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/12/01/release-apache-apisix-2.11">Apache APISIX 2.11.0 is officially released with more new features</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/30/use-apisix-ingress-in-kubesphere">Using Apache APISIX Ingress Gateway to access Custom Monitoring in KubeSphere</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/26/apache-apisix-committer-experience">Contributer to Committer journey @Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/23/cve-2021-43557-research-report">APISIX request_uri variable with risk of path penetration</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/23/cve-2021-43557">Apache APISIX Path traversal in request_uri variable(CVE-2021-43557)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/22/develop-apisix-ingress-with-nocalhost-in-kubernetes">Develop APISIX Ingress Controller with Nocalhost in K8s</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/19/apisix-supports-wasm">Apache APISIX embraces the WASM ecosystem</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/17/dapr-with-apisix">How to integrate with Dapr to build Apache APISIX Gateway Controller</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/16/weekly-report-1114">Weekly Report (Sep 1 - Sep 14)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/12/apisix-datadog">Cloud Monitoring with Datadog in Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/04/skywalking">The observability of Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/03/airwallex-usercase">API Gateway Practice in Airwallex with APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/11/02/weekly-report-1031">Weekly Report｜10.15-10.31 Feature Highlights Update in Progress</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/29/extension-guide">Apache APISIX Extensions Guide</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/26/apisix-ingress">How APISIX Ingress grown from 0 to 1</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/22/cert-manager-in-ingress">Use Cert Manager to manage certificates in Apache APISIX Ingress Controller</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/18/meetup">Webinar | Apache APISIX × Apache SkyWalking Online Meetup</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/14/weekly-report-1014">Bieekly Report (Oct 1 - Oct 14)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/13/celebrating-300-contributors-of-apisix">New milestone for the Apache APISIX community - over 300 contributors worldwide!</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/09/apisix-ingress-techblog">A thoughtful tutorial to get started with Apache APISIX Ingress from concept to practice</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/10/01/openeuler">Apache APISIX community members help openEuler release first innovation version</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/30/weekly-report">Biweekly Report (Sep 13 - Sep 30)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/29/release-apache-apisix-2.10">Release Apache APISIX 2.10.0</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/28/wps-usercase">WPS with Apache APISIX to create new API gateway experience</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/24/youpaicloud-usercase">Practice in UPYUN with APISIX Ingress</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/18/xiaodian-usercase">Apache APISIX helps DIAN to facilitate cloud native solution</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/16/tencent-cloud">Implementing Apache APISIX in Tencent Cloud TI-ONE Platform</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/15/weekly-report">BiWeekly Report (Aug 30 - Sep 15)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/14/youzan">Youzanyun PaaS for comprehensive micro-service governance with APISX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/13/china-mobile-cloud-usercase">How APISIX implemented in China Mobile Cloud</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/09/how-to-contribute-to-an-openSource-without-coding">How can I contribute to an open source project without writing code?</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/07/how-to-use-apisix-auth">Centralized Authentication with Apache APISIX and Advanced Tricks</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/07/iqiyi-usercase">Based on Apache APISIX, iQIYI API Gateway Update and landing practice</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/09/06/python-helps-you-quickly-with-apache-apisix-development">Python helps you develop Apache APISIX plugin</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/31/apache-apisix-kubeSphere-a-better-gateway-and-k8s-ingress-controller">Apache APISIX × KubeSphere: Providing a better gateway and K8S Ingress Controller</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/30/ingress-meeting">Webinar｜ See you at the Apache APISIX Ingress Community Meeting on Wednesday at 2pm!</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/30/weekly-report">Weekly Report (Aug 23 - Aug 29)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/27/release-apache-apisix-2.9">Release Apache APISIX 2.9</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/25/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication">Centralized authentication using the OpenID Connect plug-in for Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/25/why-apache-apisix-chose-nginx-and-lua">Why Apache APISIX chose Nginx and Lua to build API Gateway</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/24/shanghai-meetup-recap">Apache APISIX Meetup in Shanghai</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/23/apachecon-asia-2021">ApacheCon Asia 2021</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/23/weekly-report">Apache APISIX 社区周报 ｜ 2021 8.16-8.22</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/21/shanghai-meetup">Apache APISIX Meetup in Shanghai, welcome to register!</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/19/go-makes-apache-apisix-better">How to use Go to develop Apache APISIX plugin</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/19/weekly-report">Apache APISIX 社区周报 ｜ 08-09 ～ 08-15</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/18/auth-with-casbin-in-apache-apisix">Licensing with Casbin in Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/17/interview-airwallex">Interview with Yang to explore API gateway in Airwallex</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/16/using-the-apache-apisix-openid-connect-plugin-for-centralized-authentication">Using the Apache APISIX OpenID Connect Plugin for Okta Centralized Authentication</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/14/contributors-the-golden-metric-of-opensource-projects">Contributors — The Golden Metric of OpenSource Projects</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/12/chaos-mesh-helps-apache-apisix-improve-system-stability">Chaos Mesh Helps Apache APISIX Improve System Stability</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/11/interview-tuzhengsong">My first PR in the Apache APISIX community</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/10/apisix-nginx">APISIX Architecture: How to Dynamically Manage NGINX Cluster?</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/09/apache-apisix-in-china-mobile-cloud">Apache APISIX 在移动云的应用</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/09/apache-apisix-in-quliankeji">Abandoning Kong and Nginx, Hyperchain Technology implements on its BaaS platform</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/06/using-apache-apisix-to-improve-the-observability-of-nginx">How to Improve the Observability of Nginx with Apache APISX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/08/05/kong-to-apisix">Kong-To-APISIX Migration Tool</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/07/28/release-apache-apisix-2.8">Release Apache APISIX 2.8.0</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/07/27/use-of-plugin-orchestration-in-apache-apisix">Apply Plugin Orchestration in Apache APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/07/25/apachecon-asia">ApacheCon Asia 2021: Apache APISIX Technical Topics</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/07/21/apache-apisix-kubernetes">Live | Apache APISIX x Kubernetes</a></li><li class="sidebarItem_iLZw"><a aria-current="page" class="sidebarItemLink_Y3HD sidebarItemLinkActive_Ycqn" href="/blog/2021/07/06/the-road-to-customization-of-sina-weibo-api-gateway-based-on-apache-apisix">The Road to Customized Development of Sina Weibo API Gateway</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/07/06/celebrate-200-contributors">Apache APISIX has over 200 contributors in GitHub main repo! </a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/30/etcd3-support-http-access-perfectly">Does etcd 3 Support HTTP Access Perfectly?</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/29/release-apache-apisix-2.7">Release Apache APISIX 2.7.0</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/28/why-we-need-apache-apisix">Why do you need Apache APISIX when you have NGINX and Kong?</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/23/deploy-great-open-source-gateway-and-ingress-controller-fast">Deploy APISIX and APISIX Ingress Controller on Rancher</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/21/use-java-to-write-apache-apisix-plugins">How to Write an Apache APISIX Plugin in Java</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/18/first-ga-version-v1.0-of-apache-apisix-ingress-controller-released">APISIX Ingress Controller 1.0 Release</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/17/apache-apisix-dashboard-access-control-bypass-vulnerability-announcement">APISIX Dashboard Access Control Bypass Vulnerability Advisory (CVE-2021-33190)</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/16/chaos-mesh-helps-apache-apisix-improve-stability">Chaos Mesh Helps Apache APISIX Improve Stability</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/10/apache-apisix-and-envoy-performance-comparison">Apache APISIX v.s Envoy: Which Has the Better Performance?</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/07/apache-apisix-not-affected-by-nginx-cve-2021-23017">Apache APISIX not affected by NGINX CVE-2021-23017</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/06/06/apisix-two-years">Apache APISIX Open Source 2 Year Anniversary!</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/blog/2021/06/03/firsthand-experience-with-apache-apisix-from-ospp-2020-students">First Experience with Apache APISIX Shared by Student in OSPP 2020</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/05/25/apache-apisix-2.6.0-release">Apache APISIX Release 2.6.0</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/05/24/tencent-games">API Gateway Practice in Tencent with APISIX</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/03/02/get-front-end-test-coverage-with-cypress">Get Front-End Test Coverage with Cypress</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/02/26/install-apache-apisix-from-helm-charts">Install Apache APISIX from Helm Charts</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/02/08/stable-product-delivery-with-cypress">Stable Product Delivery with Cypress</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/01/21/run-ingress-apisix-on-amazon-eks">Run Ingress APISIX on Amazon EKS</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2021/01/11/interview-apache-apisix-contributor-wang-pengcheng-senior-security-advisor-of-pwc-south-china-data-security-and-privacy-protection-team">Apache APISIX Contributor Interview | Pengcheng Wang, Senior Security Consultant, PricewaterhouseCoopers China Data Security &amp; Privacy Team</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2020/12/18/first-look-at-kubernetes-service-api">A First Look at Kubernetes Service APIs</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2020/12/16/another-way-to-implement-envoy-filter">Envoy and Apache APISIX: Another way to implement the Envoy filter</a></li><li class="sidebarItem_iLZw"><a class="sidebarItemLink_Y3HD" href="/blog/2020/12/11/beike-how-to-build-gateway-based-on-apache-apisix">Ke Holdings Inc chooses Apache APISIX as API Gateway</a></li></ul></nav></aside><main class="col col--7" itemscope="" itemtype="http://schema.org/Blog"><article itemprop="blogPost" itemscope="" itemtype="http://schema.org/BlogPosting"><header><h1 class="blogPostTitle_XRV4" itemprop="headline">The Road to Customized Development of Sina Weibo API Gateway</h1><div class="blogPostData_cftJ margin-vert--md"><time datetime="2021-07-14T00:00:00.000Z" itemprop="datePublished">July 14, 2021</time> · 13 min read</div><div class="row margin-top--md margin-bottom--sm"><div class="col col--6 authorCol_qo3C"><div class="avatar margin-bottom--sm"><div class="avatar__intro" itemprop="author" itemscope="" itemtype="https://schema.org/Person"><div class="avatar__name"><a itemprop="url"><span itemprop="name">Yong Nie</span></a></div></div></div></div></div></header><div class="markdown" itemprop="articleBody"><blockquote><p>Sina Weibo’s previous HTTP API gateway was built based on Nginx, which brought up a series of problems. After some research, we chose Apache APISIX, which is dynamic, efficient and stable to meet the fast response requirements of the business.</p></blockquote><p>Sina Weibo’s previous HTTP API gateway was built based on Nginx, and all routing rules were stored in Nginx configuration files, which brought a series of problems: long upgrade steps, inflexibility and difficulty in troubleshooting problems when adding, deleting, changing or tracking services. After some research, we chose the closest expected, cloud-based micro-service API gateway: Apache APISIX, which is dynamic, efficient and stable to meet the rapid response requirements of the business.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="background-information"></a>Background Information<a class="hash-link" href="#background-information" title="Direct link to heading">#</a></h2><p>In Sina Weibo, if an operation engineer wants to create an API service, he/she needs to write it in the Nginx configuration file first, submit it to the git code repository, and wait for other operation engineer responsible for the online checkout to confirm the success of the audit before they can push the deployment to the line, and then brutally notify Nginx to reload it, and only then is the service change successful.</p><p>The whole process is long and inefficient, and cannot meet the trend of low-code DevOps operation and maintenance. Therefore, we expect to have a management backend portal, where operation engineer can operate all the http api routing and other configurations in the UI interface.</p><p></p><div class="rc-image"><img alt="Sina Weibo Publish Process" class="rc-image-img" src="https://user-images.githubusercontent.com/23514812/125594900-d4c01fb7-3af4-4e8c-8779-f3f16b7f0bca.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>After some research, we chose the closest to the expected cloud-based micro-services API gateway: Apache APISIX.</p><ol><li>Based on Nginx, the technology stack is unified before and after the canary release upgrade, security, stability, etc. are guaranteed.</li><li>Built-in unified control surface, unified management of multiple proxy services.</li><li>Dynamic API call, you can complete the common resource modifications in real time, compared to the traditional Nginx configuration + reload way progress is obvious.</li><li>Rich routing options to meet the needs of Sina Weibo routing.</li><li>Good scalability, support Consul kv.</li><li>Good performance.</li></ol><p></p><div class="rc-image"><img alt="Apache APISIX Architecture" class="rc-image-img" src="https://user-images.githubusercontent.com/23514812/125596483-aee21ac7-a902-4e44-abc4-8bfda4f51f82.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="why-did-we-choose-custom-development"></a>Why Did We Choose Custom Development?<a class="hash-link" href="#why-did-we-choose-custom-development" title="Direct link to heading">#</a></h2><p>In the actual business situation, we cannot use Apache APISIX directly for the following reasons.</p><ol><li>Apache APISIX does not support SaaS multi-tenancy, and there are many upper-layer applications that actually need to be operated and maintained, and each business line development or operation and maintenance student only needs to manage and maintain their own rules, upstreams and other rules, which are not associated with each other.</li><li>When the routing rules are published online, they need fast roll back support if problems arise.</li><li>When creating or editing existing routing rules, we are not so sure about publishing them directly to the wire, and then we need it to be able to support canary release to a specified gateway instance for simulation or local testing.</li><li>The need for API gateways to be able to support Consul KV-style service registration and discovery mechanisms.</li></ol><p>None of these requirements are currently supported built-in by Apache APISIX, so custom development is the only way to make Apache APISIX truly usable within Weibo.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="what-did-we-change-in-the-control-plane-of-apacheapisix"></a>What Did We Change in the Control Plane of Apache APISIX?<a class="hash-link" href="#what-did-we-change-in-the-control-plane-of-apacheapisix" title="Direct link to heading">#</a></h2><p>For our custom development, we used Apache APISIX version 1.5, and Apache APISIX Dashboard compatible with Apache APISIX version 1.5.</p><p>The goal of custom development is simple and clear, that is, completely zero code, UI, all seven layers of HTTP API service creation, editing, updating, up and down and all other actions must be done on the Dashboard. Therefore, in the actual environment, we forbid development and operation and operation engineer to call APISIX Admin API directly. If we skip the Dashboard and call APISIX Admin API directly, it will lead to the gateway operation not being audited at the UI level, so we cannot take the workflow, and naturally, there is not much security to speak of.</p><p>There is a slightly special case, operations and maintenance need to call the API to complete the bulk import of services, you can call the H5 Dashboard API to complete, so as to comply with the unified workflow.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="support-saas-based-services"></a>Support Saas-based Services<a class="hash-link" href="#support-saas-based-services" title="Direct link to heading">#</a></h3><p>A complete database of product lines and business lines is available at the enterprise level, and each specific product line and business line can be represented by a saas_id value. Then, before creating the gateway configuration data for insertion into the ETCD, a saas_id value is plugged in and all the data has a SaaS attribution in terms of logical attributes.</p><p>Users, roles and the actual product line of operation are then associated with the following correspondence.</p><p></p><div class="rc-image"><img alt="Users, roles and product association" class="rc-image-img" src="https://static.apiseven.com/202108/1646899698131-8e90270e-9849-435e-b776-0827c04b293c.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>A user can be assigned to undertake different operations and maintenance roles to manage and maintain different product lines of services.</p><p>The administrator role is very easy to understand, the core role of operation and maintenance services, for service addition / deletion / update / check; in addition, we have the concept of read-only users, read-only users are generally used to view the service configuration, view the workflow, debugging and so on.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="add-audit-function"></a>Add Audit Function<a class="hash-link" href="#add-audit-function" title="Direct link to heading">#</a></h3><p></p><div class="rc-image"><img alt="Audit Function1" class="rc-image-img" src="https://static.apiseven.com/202108/1646899698135-0b92ed91-0803-4f2c-8d4b-6873c19fa492.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>In the open source version, a route can be published directly after it is created or modified.</p><p>In our custom version, after a route is created or modified, it needs to go through an audit workflow before it can be published, which lengthens the process, but we think it is more credible to publish after the authorization is reviewed at the enterprise level.</p><p></p><div class="rc-image"><img alt="Audit Function2" class="rc-image-img" src="https://static.apiseven.com/202108/1646900059586-f7feca14-57ed-417b-aadc-ca02e31bfa47.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>When creating routing rules, they must be reviewed by default. To take into account efficiency, when entering new services, you can choose the no-review, fast-publishing channel and click the publish button directly.</p><p></p><div class="rc-image"><img alt="Audit Function3" class="rc-image-img" src="https://static.apiseven.com/202108/1646900090210-6f08f1e5-fc62-4148-9d5a-879bc96a54d2.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>When an important API route has problems after a certain adjustment rule release goes live, you can select the previous version of the routing rule for a quick roll back, with the granularity of a single route roll back that will not affect other routing rules.</p><p>The internal processing flow of a single route roll back is shown in the following figure.</p><p></p><div class="rc-image"><img alt="Audit Function4" class="rc-image-img" src="https://static.apiseven.com/202108/1646900126327-f297be1b-c7e5-4991-9fea-0e1e87bea937.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>We need to create version database storage for each release of a single route. This way, when we do a full release after the audit, each release will generate a version number and the corresponding full configuration data; then the version list grows. When we need to roll back, go to the version list and select a corresponding version to rollback; in a sense, the roll back is actually a special form of full release.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="support-canary-release"></a>Support Canary Release<a class="hash-link" href="#support-canary-release" title="Direct link to heading">#</a></h3><p>Our custom-developed canary release feature is different from what the community generally understands as canary release, and is less risky compared to full deployment. When a change to a routing rule is large, we can choose to publish and take effect only on a specific limited number of gateway instances, instead of publishing and taking effect on all gateway instances, thus reducing the scope of the release, lowering the risk, and enabling fast trial and error.</p><p>Although canary release is a low-frequency behavior, there is still a state transition between it and full volume release.</p><p></p><div class="rc-image"><img alt="Support Canary Release1" class="rc-image-img" src="https://static.apiseven.com/202108/1646900161267-83d3bb57-596c-4e23-8fa3-4999739a77ca.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>When the percentage of canary release decreases to 0%, it is the state of full release; when the canary release rises to 100%, it is the next full release, and this is its state transition.
The full canary release feature requires some API support exposed on the gateway instance in addition to the administrative backend support.</p><p></p><div class="rc-image"><img alt="Support Canary Release2" class="rc-image-img" src="https://static.apiseven.com/202108/1646900188100-bf697358-4d6a-44d7-ab3d-223728e860b2.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>The above screenshot shows the screenshot when operating canary release to select a specific gateway instance.</p><p>The full canary release feature requires some API support exposed on the gateway instance in addition to the administrative backend support.</p><p></p><div class="rc-image"><img alt="Support Canary Release3" class="rc-image-img" src="https://static.apiseven.com/202108/1646900211377-0c1df098-c5be-4c69-bda6-eabd1518f0f5.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>Canary release API fixed URI, the unified path is /admin/services/gray/{SAAS_ID}/ routes. Different HTTP Method presents different business meanings, POST means create, DELETE means to stop canary release, GET means to view.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_c7R8" id="activation-process"></a>Activation Process<a class="hash-link" href="#activation-process" title="Direct link to heading">#</a></h4><p></p><div class="rc-image"><img alt="Activation Process" class="rc-image-img" src="https://static.apiseven.com/202108/1646900248884-ca1757d7-e6c0-45a3-a677-d29184b494d8.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>An API is published from the gateway level, and after receiving the data the worker process checks the legitimacy of the data sent, and the legitimate data is broadcast to all worker processes via events. Then the canary release API is called and the canary release rules are added and take effect when the next request is processed.</p><h4><a aria-hidden="true" tabindex="-1" class="anchor anchor__h4 anchorWithHideOnScrollNavbar_c7R8" id="deactivation-process"></a>Deactivation Process<a class="hash-link" href="#deactivation-process" title="Direct link to heading">#</a></h4><p></p><div class="rc-image"><img alt="Deactivation Process" class="rc-image-img" src="https://static.apiseven.com/202108/1646900280677-87a90d54-c78d-4660-afab-33bbc433010d.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>The deactivation process is basically the same as the canary release distribution process. The API for canary release distribution is called by the DELETE method and broadcasted to all work processes. If it exists in the route table, delete it and try to restore it from the ETCD. If the canary release is deactivated, make sure that the original ETCD can be restored without affecting the normal service.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="support-fastimport"></a>Support Fast Import<a class="hash-link" href="#support-fastimport" title="Direct link to heading">#</a></h3><p>In addition to supporting the creation of routes on the management page, many operation engineer are still more accustomed to using scripts to import. We have a large number of HTTP API services, and it would be very time-consuming to manually enter them one by one. If you import through scripts, you can reduce a lot of service migration resistance.</p><p>By exposing the Go Import HTTP API for the management backend, the operation engineer can fill in the assigned token, SaaS ID and related UIDs in the ready-made Bash Script file to import the services into the management backend more quickly. The subsequent operation of importing services still needs to be done in the management backend H5 interface.</p><p></p><div class="rc-image"><img alt="Fast Import" class="rc-image-img" src="https://user-images.githubusercontent.com/23514812/125597641-54bf1649-0238-4973-8501-48c1cead328e.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="what-did-we-change-in-the-data-plane-of-apacheapisix"></a>What Did We Change in the Data Plane of Apache APISIX?<a class="hash-link" href="#what-did-we-change-in-the-data-plane-of-apacheapisix" title="Direct link to heading">#</a></h2><p>Custom development based on the Apache APISIX data surface requires a number of code path rules to be followed. In particular, the code for the Apache APISIX gateway and the custom code are stored in separate paths, and the two work together and can each be iterated independently.</p><p></p><div class="rc-image"><img alt="Changes in the Data Plane" class="rc-image-img" src="https://static.apiseven.com/202108/1646900844425-46711779-fa2c-4242-a3c4-311fd5ea2563.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="modification-of-installation-package"></a>Modification of Installation Package<a class="hash-link" href="#modification-of-installation-package" title="Direct link to heading">#</a></h3><p>So when packaging, not only custom code, but also dependencies, configuration, etc. all need to be packaged together for distribution. As for the output format, you can either choose Docker or type it into a tarball, as required.</p><p></p><div class="rc-image"><img alt="Modification of Installation Package" class="rc-image-img" src="https://static.apiseven.com/202108/1646900306141-5f85e7e9-3e13-4477-957c-657d5435bdef.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="custom-development-ofcode"></a>Custom Development of Code<a class="hash-link" href="#custom-development-ofcode" title="Direct link to heading">#</a></h3><p>Some custom modules need to be loaded first when they are initialized, so that the code intrusion into Apache APISIX becomes minimal, requiring only modifications to the Nginx.conf file.</p><p></p><div class="rc-image"><img alt="Custom Development of Code1" class="rc-image-img" src="https://static.apiseven.com/202108/1646900356726-16c7b794-c5d9-43a4-af60-7dc675f56dc7.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>For example, if you need to stuff an upstream object with a saas_id attribute field, you can call the following method at initialize time.</p><p></p><div class="rc-image"><img alt="Custom Development of Code2" class="rc-image-img" src="https://static.apiseven.com/202108/1646900387986-d7036503-98a9-4cb8-a47e-27e7ae83796b.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>You need to be called in the initworker_by_lua* phase to complete the initialization for similar modifications.</p><p>Another scenario: how to directly rewrite the implementation of a currently existing module. For example, if you have a debug module and now you need to refactor its initialization logic, i.e. rewrite the init_worker function.</p><p></p><div class="rc-image"><img alt="Custom Development of Code3" class="rc-image-img" src="https://user-images.githubusercontent.com/23514812/125598066-fd0da722-7fb0-44a2-99cd-15bf07fd1ad6.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>The advantage of this approach is that it not only keeps the original physical API files intact, but also adds custom API-specific logic rewrites, thus reducing the cost of later code management and bringing great convenience for subsequent upgrades.</p><p>If you have similar needs in a production environment, you can refer to the above approach.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="support-consulkv"></a>Support Consul KV<a class="hash-link" href="#support-consulkv" title="Direct link to heading">#</a></h3><p>Currently, most of Weibo services use Consul KV as a service registration and discovery mechanism. Previously, Apache APISIX did not support the Consul KV method of service discovery mechanism, so a <code>consul_kv.lua</code> module needs to be added to the gateway layer, and a UI interface needs to be provided in the management backend as follows.</p><p></p><div class="rc-image"><img alt="Support Consul KV1" class="rc-image-img" src="https://static.apiseven.com/202108/1646900423967-5b5db4c1-1c2c-495c-88ef-e0f4937bcef8.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>In the upstream list in the console, everything is filled in at a glance, and the metadata of all registered nodes is automatically presented when the mouse is moved over the registered service address, which greatly facilitates the daily operation of our operation engineers.</p><p></p><div class="rc-image"><img alt="Support Consul KV2" class="rc-image-img" src="https://static.apiseven.com/202108/1646900450031-bf0109c1-c859-4fbd-9a47-967c193d27ff.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>The <code>consul_kv.lua</code> module is relatively simple to configure at the gateway level, supporting multiple connections to different Consul clusters at the same time, but this is also due to the requirements of the actual environment.</p><p></p><div class="rc-image"><img alt="Support Consul KV3" class="rc-image-img" src="https://static.apiseven.com/202108/1646900471956-9490a2d0-256d-4f15-b24e-6f8204a60a17.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>This code has now been merged into the APISIX master branch and is included in version 2.4.</p><p>The module&#x27;s process model uses a subscription publishing model, where each gateway instance has one and only one process that polls multiple Consul service clusters with long connections and broadcasts new data to all business sub-processes as it becomes available.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="problems-encountered-during-customization"></a>Problems Encountered during Customization<a class="hash-link" href="#problems-encountered-during-customization" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="high-costs-for-migration"></a>High Costs for Migration<a class="hash-link" href="#high-costs-for-migration" title="Direct link to heading">#</a></h3><p>At the operation and maintenance level, we are actually facing a problem of migration cost.</p><p>Any new thing appeared, used to replace the existing foundation, will not be a smooth ride, but need to go through a period of time slowly familiar with, improve knowledge, and then keep trial and error, slowly move forward, and gradually eliminate all kinds of doubts in our minds. Only after a period of stable operation and various problems have been solved, will the next step of more rapid replacement phase be entered. There is no doubt that the use of APISIX in Weibo is still in the stage of gradual advancement, and we are still familiarizing ourselves with it, learning it, and gaining a deeper understanding of it, while solving various migration problems in order to find the best practice path.</p><p>For example, during the migration process, you need to import various upstream and routing rules from the Nginx.conf file into the gateway system administration backend one by one, which is a very tedious and manual process.</p><p></p><div class="rc-image"><img alt="High Costs for Migration" class="rc-image-img" src="https://user-images.githubusercontent.com/23514812/125598279-1fa93710-e5a0-4dc4-b42b-46b02f66f6a8.png"><div class="rc-image-mask">Click to Preview</div></div><p></p><p>At the same time, we will also encounter Nginx various complex variable judgment statements, at present, we mainly find one to solve one, and continue to accumulate experience.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="high-costs-forupgrades"></a>High Costs for Upgrades<a class="hash-link" href="#high-costs-forupgrades" title="Direct link to heading">#</a></h3><p>High level of customization, resulting in higher costs for subsequent upgrades. We are currently experiencing the same problem as everyone else, many people should be based on version 1.x Apache APISIX how to upgrade to 2.0, we also have a Dashboard of private custom development, the subsequent upgrade costs should be higher.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="feeding-the-community"></a>Feeding the Community<a class="hash-link" href="#feeding-the-community" title="Direct link to heading">#</a></h3><p>The final part is about the Apache APISIX community. We have been thinking about how to feed features of interest to the Apache APISIX community for everyone to use and modify together.</p><p>It is an objective fact that our custom development is driven primarily by actual internal Weibo requirements, and there is some variation from the evolution driven by the Apache APISIX community. However, excluding code that contains sensitive data, there are always common needs at the code level for more general functionality that the enterprise and open source communities can push together to make more stable and mature. For example, a common Consul KV service discovery module, handling of some highly available profiles, and fixes for other issues.</p><p>These common requirements are typically polished internally for a period of time until they fully satisfy internal requirements, and then gradually submitted to the community open source branch, but this also requires a process.</p></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_GzFC"><div class="col"><b>Tags:</b><ul class="tags_5N4j padding--none margin-left--sm"><li class="tag_LKyA"><a class="tag_JoRF tagRegular_BENv" href="/blog/tags/user-case">User Case</a></li></ul></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog/2021/07/21/apache-apisix-kubernetes"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">« Live | Apache APISIX x Kubernetes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/07/06/celebrate-200-contributors"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Apache APISIX has over 200 contributors in GitHub main repo!  »</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_thVJ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#background-information" class="table-of-contents__link">Background Information</a></li><li><a href="#why-did-we-choose-custom-development" class="table-of-contents__link">Why Did We Choose Custom Development?</a></li><li><a href="#what-did-we-change-in-the-control-plane-of-apacheapisix" class="table-of-contents__link">What Did We Change in the Control Plane of Apache APISIX?</a><ul><li><a href="#support-saas-based-services" class="table-of-contents__link">Support Saas-based Services</a></li><li><a href="#add-audit-function" class="table-of-contents__link">Add Audit Function</a></li><li><a href="#support-canary-release" class="table-of-contents__link">Support Canary Release</a></li><li><a href="#support-fastimport" class="table-of-contents__link">Support Fast Import</a></li></ul></li><li><a href="#what-did-we-change-in-the-data-plane-of-apacheapisix" class="table-of-contents__link">What Did We Change in the Data Plane of Apache APISIX?</a><ul><li><a href="#modification-of-installation-package" class="table-of-contents__link">Modification of Installation Package</a></li><li><a href="#custom-development-ofcode" class="table-of-contents__link">Custom Development of Code</a></li><li><a href="#support-consulkv" class="table-of-contents__link">Support Consul KV</a></li></ul></li><li><a href="#problems-encountered-during-customization" class="table-of-contents__link">Problems Encountered during Customization</a><ul><li><a href="#high-costs-for-migration" class="table-of-contents__link">High Costs for Migration</a></li><li><a href="#high-costs-forupgrades" class="table-of-contents__link">High Costs for Upgrades</a></li><li><a href="#feeding-the-community" class="table-of-contents__link">Feeding the Community</a></li></ul></li></ul></div></div></div></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/general/join">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/showcase">Showcase</a></li><li class="footer__item"><a class="footer__link-item" href="/plugins">Plugin Hub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_fkq+"><img src="https://static.apiseven.com/202202/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_3EHU themedImage--light_heW6 footer__logo"><img src="https://static.apiseven.com/202202/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_3EHU themedImage--dark_6pZL footer__logo"></a></div><div class="footer__copyright">Copyright © 2019-2022 The Apache Software Foundation. Apache APISIX, APISIX®, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/assets/js/runtime~main.f3244aab.js"></script>
<script src="https://apisix-website-static.apiseven.com/assets/js/main.86bd6361.js"></script>
</body>
<script>window.onload=function(){window.location.host.endsWith(".netlify.app")&&document.querySelector("#__docusaurus").insertAdjacentHTML("afterend",'<div style="text-align: right;padding: 48px 32px 48px 0;">This site is powered by <a href="https://www.netlify.com/" target="_blank">Netlify</a></div>')}</script>
</html>