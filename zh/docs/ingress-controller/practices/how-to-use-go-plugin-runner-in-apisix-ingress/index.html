<!doctype html>
<html class="docs-version-current" lang="zh" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="ahrefs-site-verification" content="c2f7370ecf46173f4fb25f114e74c97e0a2976d4f02f61c9b00a9d7d34e34698">
<meta name="generator" content="Docusaurus v2.0.0-beta.6">
<link rel="alternate" type="application/rss+xml" href="/zh/blog/rss.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/blog/atom.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=GTM-K24PRPS"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","GTM-K24PRPS",{})</script>
<link rel="search" type="application/opensearchdescription+xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway" href="/zh/opensearch.xml">
<link rel="alternate" type="application/rss+xml" href="/zh/articles/rss.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/zh/articles/atom.xml" title="Apache APISIX¬Æ -- Cloud-Native API Gateway Blog Atom Feed"><title data-react-helmet="true">How to use go-plugin-runner with APISIX Ingress | Apache APISIX¬Æ -- Cloud-Native API Gateway</title><meta data-react-helmet="true" property="og:image" content="https://static.apiseven.com/202202/apache-apisix.png"><meta data-react-helmet="true" name="twitter:image" content="https://static.apiseven.com/202202/apache-apisix.png"><meta data-react-helmet="true" property="og:url" content="https://apisix.apache.org/zh/docs/ingress-controller/practices/how-to-use-go-plugin-runner-in-apisix-ingress"><meta data-react-helmet="true" name="docsearch:language" content="zh"><meta data-react-helmet="true" name="docsearch:version" content="current"><meta data-react-helmet="true" name="docsearch:docusaurus_tag" content="docs-docs-apisix-ingress-controller-current"><meta data-react-helmet="true" name="robots" content="index,follow"><meta data-react-helmet="true" name="twitter:card" content="summary"><meta data-react-helmet="true" property="og:title" content="How to use go-plugin-runner with APISIX Ingress | Apache APISIX¬Æ -- Cloud-Native API Gateway"><meta data-react-helmet="true" name="description" content="This document walks through how you can use the go plugin runner in the APISIX ingress controller"><meta data-react-helmet="true" property="og:description" content="This document walks through how you can use the go plugin runner in the APISIX ingress controller"><meta data-react-helmet="true" name="keywords" content="Apache APISIX Ingress,Plugin,Ingress Controller,Go Plugin Runner,multi language"><link data-react-helmet="true" rel="shortcut icon" href="https://static.apiseven.com/202202/favicon.png"><link data-react-helmet="true" rel="canonical" href="https://apisix.apache.org/zh/docs/ingress-controller/practices/how-to-use-go-plugin-runner-in-apisix-ingress"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/docs/ingress-controller/practices/how-to-use-go-plugin-runner-in-apisix-ingress" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/zh/docs/ingress-controller/practices/how-to-use-go-plugin-runner-in-apisix-ingress" hreflang="zh"><link data-react-helmet="true" rel="alternate" href="https://apisix.apache.org/docs/ingress-controller/practices/how-to-use-go-plugin-runner-in-apisix-ingress" hreflang="x-default"><link data-react-helmet="true" rel="preconnect" href="https://38VC84A2WJ-dsn.algolia.net" crossorigin="anonymous"><link rel="preload" href="https://apisix-website-static.apiseven.com/zh/assets/js/runtime~main.7eccae1e.js" as="script">
<link rel="preload" href="https://apisix-website-static.apiseven.com/zh/assets/js/main.2db8c3d8.js" as="script">
<link rel="stylesheet" href="https://apisix-website-static.apiseven.com/zh/assets/css/styles.02b41649.css">

<script>var _paq=window._paq=window._paq||[];_paq.push(["disableCookies"]),_paq.push(["trackPageView"]),_paq.push(["enableLinkTracking"]),function(){var a="https://analytics.apache.org/";_paq.push(["setTrackerUrl",a+"matomo.php"]),_paq.push(["setSiteId","17"]);var e=document,p=e.createElement("script"),t=e.getElementsByTagName("script")[0];p.async=!0,p.src=a+"matomo.js",t.parentNode.insertBefore(p,t)}()</script>

</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}(),document.documentElement.setAttribute("data-announcement-bar-initially-dismissed",function(){try{return"true"===localStorage.getItem("docusaurus.announcement.dismiss")}catch(t){}return!1}())</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_QVmC">Skip to main content</a></div><div class="announcementBar_gVRT" style="background-color:#e8433e;color:white" role="banner"><div class="announcementBarPlaceholder_csWV"></div><div class="announcementBarContent_2kKG">ü§î Have queries regarding API Gateway? Join Slack channel to discuss <a target="_blank" rel="noopener noreferrer" href="/docs/general/join">join #apisix channel</a>! ‚≠êÔ∏è</div><button type="button" class="clean-btn close announcementBarClose_EDEK" aria-label="Close"><svg viewBox="0 0 24 24" width="14" height="14" fill="currentColor"><path d="M24 20.188l-8.315-8.209 8.2-8.282-3.697-3.697-8.212 8.318-8.31-8.203-3.666 3.666 8.321 8.24-8.206 8.313 3.666 3.666 8.237-8.318 8.285 8.203z"></path></svg></button></div><nav class="navbar navbar--fixed-top navbarHideable_IWhJ"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/zh/"><img src="/zh/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_3EHU themedImage--light_heW6 navbar__logo"><img src="/zh/img/logo2.svg" alt="Apache APISIX¬Æ" class="themedImage_3EHU themedImage--dark_6pZL navbar__logo"><b class="navbar__title">Apache APISIX¬Æ</b></a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a aria-current="page" class="navbar__link" href="/zh/docs">ÊñáÊ°£</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/docs/apisix/getting-started">Apache APISIX¬ÆÔ∏è</a></li><li><a class="dropdown__link" href="/zh/docs/dashboard/USER_GUIDE">Apache APISIX¬ÆÔ∏è Dashboard</a></li><li><a class="dropdown__link" href="/zh/docs/ingress-controller/getting-started/">Apache APISIX¬ÆÔ∏è Ingress Controller</a></li><li><a class="dropdown__link" href="/zh/docs/helm-chart/apisix/">Apache APISIX¬ÆÔ∏è Helm Charts</a></li><li><a class="dropdown__link" href="/zh/docs/docker/build/">Apache APISIX¬ÆÔ∏è Docker</a></li><li><a class="dropdown__link" href="/zh/docs/java-plugin-runner/development/">Apache APISIX¬ÆÔ∏è Java Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/go-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Go Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/python-plugin-runner/getting-started/">Apache APISIX¬ÆÔ∏è Python Plugin Runner</a></li><li><a class="dropdown__link" href="/zh/docs/general/join">General</a></li></ul></div><a class="navbar__item navbar__link" href="/zh/blog">ÂçöÂÆ¢</a><a class="navbar__item navbar__link" href="/zh/blog/tags/user-case">Áî®Êà∑Ê°à‰æã</a><a class="navbar__item navbar__link" href="/zh/downloads">‰∏ãËΩΩ</a><a class="navbar__item navbar__link" href="/zh/help">Â∏ÆÂä©</a><a class="navbar__item navbar__link" href="/zh/team">Âõ¢Èòü</a><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link">Áõ∏ÂÖ≥ËµÑÊ∫ê</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/zh/showcase">‰ΩøÁî®Ê°à‰æã</a></li><li><a class="dropdown__link" href="/zh/plugins">Êèí‰ª∂Â∏ÇÂú∫</a></li><li><a class="dropdown__link" href="/zh/docs/general/join">Âä†ÂÖ•Á§æÂå∫</a></li><li><a class="dropdown__link" href="/zh/docs/general/events">Á§æÂå∫Ê¥ªÂä®</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" class="iconLanguage_zID8"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>ÁÆÄ‰Ωì‰∏≠Êñá</span></span></a><ul class="dropdown__menu"><li><a href="/docs/ingress-controller/practices/how-to-use-go-plugin-runner-in-apisix-ingress" target="_self" rel="noopener noreferrer" class="dropdown__link" style="text-transform:capitalize">English</a></li><li><a href="/zh/docs/ingress-controller/practices/how-to-use-go-plugin-runner-in-apisix-ingress" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">ÁÆÄ‰Ωì‰∏≠Êñá</a></li></ul></div><div class="react-toggle toggle_pM6S react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_5Cll">üåú</span></div><div class="react-toggle-track-x"><span class="toggle_5Cll">üåû</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div><div class="searchBox_xkIr"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_GMj9"><button class="clean-btn backToTopButton_THz+" type="button"><svg viewBox="0 0 24 24" width="28"><path d="M7.41 15.41L12 10.83l4.59 4.58L18 14l-6-6-6 6z" fill="currentColor"></path></svg></button><main class="docMainContainer_Q970 docMainContainerEnhanced_ipQ4"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_+ye-"><div class="docItemContainer_G97A"><article><div class="tocCollapsible_Rhao theme-doc-toc-mobile tocMobile_HuTu"><button type="button" class="clean-btn tocCollapsibleButton_Rimw">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>How to use go-plugin-runner with APISIX Ingress</h1></header><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="description"></a>Description<a class="hash-link" href="#description" title="Direct link to heading">#</a></h2><p>Based on version 0.3 of the go-plugin-runner plugin and version 1.4.0 of APISIX Ingress, this document walks through how you can use the go plugin runner in the APISIX ingress controller. This article goes through steps as follows:</p><ol><li>Prepare the environment.</li><li>Create the cluster.</li><li>Build a container image that includes the go-plugin-runner.</li><li>Customize the Helm chart package.</li><li>Install and deploy.</li><li>Verify the function.</li></ol><p>It is guaranteed that the final result can be derived in full based on this environment example as follows:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">go-plugin-runner: </span><span class="token number" style="color:#36acaa">0.3</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">APISIX Ingress: </span><span class="token number" style="color:#36acaa">1.4</span><span class="token plain">.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kind: v0.12.0</span></span><span class="token-line" style="color:#393A34"><span class="token plain">kubectl version</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">Client/Server</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">: v1.23.5/v1.23.4</span></span><span class="token-line" style="color:#393A34"><span class="token plain">golang: </span><span class="token number" style="color:#36acaa">1.18</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="build-a-cluster-environment"></a>Build a cluster environment<a class="hash-link" href="#build-a-cluster-environment" title="Direct link to heading">#</a></h2><p>Select <code>kind</code> to build a local cluster environment. The command is as follows:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">cat</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;&lt;</span><span class="token string" style="color:#e3116c">EOF</span><span class="token string bash punctuation" style="color:#393A34"> </span><span class="token string bash punctuation operator" style="color:#393A34">|</span><span class="token string bash punctuation" style="color:#393A34"> kind create cluster --config</span><span class="token string bash punctuation operator" style="color:#393A34">=</span><span class="token string bash punctuation" style="color:#393A34">-</span><span class="token string" style="color:#e3116c"></span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">kind: Cluster</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">apiVersion: kind.x-k8s.io/v1alpha4</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">nodes:</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">- role: control-plane</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  extraPortMappings:</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - containerPort: 80</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    hostPort: 80</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    protocol: TCP</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">  - containerPort: 443</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    hostPort: 443</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">    protocol: TCP</span></span><span class="token-line" style="color:#393A34"><span class="token string" style="color:#e3116c">EOF</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="build-the-go-plugin-runner-executable"></a>Build the go-plugin-runner executable<a class="hash-link" href="#build-the-go-plugin-runner-executable" title="Direct link to heading">#</a></h2><p>Choose a folder address <code>/home/chever/api7/cloud_native/tasks/plugin-runner</code> and place our <code>apisix-go-plugin-runner</code> project in this folder. Then you need to go to the <code>apisix-go-plugin-runner/cmd/go-runner/plugins</code> directory and write the plugins you need in that directory.</p><p>After writing the plugins, start compiling the executable formally, and note here that you should build <strong>static executables</strong>, not dynamic ones.</p><p>The package compile command is as follows.</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token assign-left variable" style="color:#36acaa">CGO_ENABLED</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0</span><span class="token plain"> go build -a -ldflags </span><span class="token string" style="color:#e3116c">&#x27;-extldflags &quot;-static&quot;&#x27;</span><span class="token plain"> </span><span class="token builtin class-name">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>This successfully packages a statically compiled <code>go-runner</code> executable in the <code>apisix-go-plugin-runner/cmd/go-runner/</code> directory.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="build-docker-image"></a>Build Docker Image<a class="hash-link" href="#build-docker-image" title="Direct link to heading">#</a></h2><p>The image is built here in preparation for installing APISIX later using <code>helm</code>.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="write-dockerfile"></a>Write Dockerfile<a class="hash-link" href="#write-dockerfile" title="Direct link to heading">#</a></h3><p>Return to the path <code>/home/chever/api7/cloud_native/tasks/plugin-runner</code> and create a Dockerfile in that directory, a demonstration of which is given here.</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O dockerfile"><pre tabindex="0" class="prism-code language-dockerfile codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain"># DockerfileForRunner</span></span><span class="token-line" style="color:#393A34"><span class="token plain">FROM apache/apisix:2.13.1-alpine</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">COPY ./apisix-go-plugin-runner /usr/local/apisix-go-plugin-runner</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>Here I will again emphasize the path address as follows where the executable file is located.</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">/usr/local/apisix-go-plugin-runner/cmd/go-runner/go-runner</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>Please make a note of this address. We will use it in the rest of the configuration.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="begin-to-build-docker-image"></a>Begin to build Docker Image<a class="hash-link" href="#begin-to-build-docker-image" title="Direct link to heading">#</a></h3><p>Start building a Docker image based on the Dockerfile. The command is executed in the <code>/home/chever/api7/cloud_native/tasks/plugin-runner</code> directory. The command is as follows:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">docker</span><span class="token plain"> build -t apisix/forrunner:0.1 </span><span class="token builtin class-name">.</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>Command Explanation: Build an image with the name <code>apisix/forrunner</code> and mark it as version 0.1.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="load-the-image-to-the-cluster-environment"></a>Load the image to the cluster environment<a class="hash-link" href="#load-the-image-to-the-cluster-environment" title="Direct link to heading">#</a></h3><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">kind load docker-image apisix/forrunner:0.1</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>Load the image into the kind cluster environment to pull the custom local image for installation during the helm installation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="install-apisix-ingress"></a>Install APISIX Ingress<a class="hash-link" href="#install-apisix-ingress" title="Direct link to heading">#</a></h2><p>Then install APISIX using helm with the following command in the directory of Apache APISIX Helm Chart:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">helm </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> apisix apisix/apisix --set gateway.type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">NodePort --set apisix.image.repository</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">custom/apisix --set apisix.image.tag</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">v0.1 --set extPlugin.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true --set extPlugin.cmd</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;{&quot;/usr/local/apisix-go-plugin-runner/go-runner&quot;, &quot;run&quot;}&#x27;</span><span class="token plain"> --set ingress-controller.enabled</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">true --set ingress-controller.config.apisix.serviceNamespace</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">apisix --namespace apisix --create-namespace --set ingress-controller.config.apisix.serviceName</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">apisix-admin</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="create-httpbin-service-and-apisixroute-resources"></a>Create httpbin service and ApisixRoute resources<a class="hash-link" href="#create-httpbin-service-and-apisixroute-resources" title="Direct link to heading">#</a></h2><p>Create an httpbin backend resource to run with the deployed ApisixRoute resource to test that the functionality is working correctly.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="create-httpbin-service"></a>Create httpbin service<a class="hash-link" href="#create-httpbin-service" title="Direct link to heading">#</a></h3><p>Create an httpbin service with the following command:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl run httpbin --image kennethreitz/httpbin --port </span><span class="token number" style="color:#36acaa">80</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>Expose the port with the following command:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl expose pod httpbin --port </span><span class="token number" style="color:#36acaa">80</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor anchor__h3 anchorWithHideOnScrollNavbar_c7R8" id="create-apisixroute-resource"></a>Create ApisixRoute Resource<a class="hash-link" href="#create-apisixroute-resource" title="Direct link to heading">#</a></h3><p>Create the <code>go-plugin-runner-route.yaml</code> file to enable the ApisixRoute resource, with the following configuration file:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O yaml"><pre tabindex="0" class="prism-code language-yaml codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">apiVersion</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> apisix.apache.org/v2beta3</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">kind</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ApisixRoute</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">metadata</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> plugin</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">runner</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">demo</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">spec</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> rule1</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">match</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">hosts</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> local.httpbin.org</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">paths</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> /get</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">backends</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">serviceName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> httpbin</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">servicePort</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">80</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">plugins</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ext</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">plugin</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">pre</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">req</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">enable</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">config</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token key atrule" style="color:#00a4db">conf</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">name</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;say&quot;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token key atrule" style="color:#00a4db">value</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;{\&quot;body\&quot;: \&quot;hello\&quot;}&quot;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>The create resource command is as follows:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl apply -f go-plugin-runner-route.yaml</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor anchor__h2 anchorWithHideOnScrollNavbar_c7R8" id="test"></a>Test<a class="hash-link" href="#test" title="Direct link to heading">#</a></h2><p>The command is as follows to test if the plugin written in Golang is working correctly:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">kubectl </span><span class="token builtin class-name">exec</span><span class="token plain"> -it -n </span><span class="token variable" style="color:#36acaa">${namespace of Apache APISIX}</span><span class="token plain"> </span><span class="token variable" style="color:#36acaa">${Pod name of Apache APISIX}</span><span class="token plain"> -- </span><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> http://127.0.0.1:9080/get -H </span><span class="token string" style="color:#e3116c">&#x27;Host: local.httpbin.org&#x27;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div><p>And you will see the result as follows:</p><div class="codeBlockContainer_8r9j"><div class="codeBlockContent_6g8O bash"><pre tabindex="0" class="prism-code language-bash codeBlock_U6z7 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_qR4p"><span class="token-line" style="color:#393A34"><span class="token plain">Defaulted container </span><span class="token string" style="color:#e3116c">&quot;apisix&quot;</span><span class="token plain"> out of: apisix, wait-etcd </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">init</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">hello</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_ycDu clean-btn">Copy</button></div></div></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="theme-doc-footer-edit-meta-row row"><div class="col"><a href="https://github.com/apache/apisix-ingress-controller/edit/master/docs/zh/latest/practices/how-to-use-go-plugin-runner-in-apisix-ingress.md" target="_blank" rel="noreferrer noopener" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_glMr" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_D6LQ"></div></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"></div></nav></div></div><div class="col col--3"><div class="tableOfContents_thVJ thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#description" class="table-of-contents__link">Description</a></li><li><a href="#build-a-cluster-environment" class="table-of-contents__link">Build a cluster environment</a></li><li><a href="#build-the-go-plugin-runner-executable" class="table-of-contents__link">Build the go-plugin-runner executable</a></li><li><a href="#build-docker-image" class="table-of-contents__link">Build Docker Image</a><ul><li><a href="#write-dockerfile" class="table-of-contents__link">Write Dockerfile</a></li><li><a href="#begin-to-build-docker-image" class="table-of-contents__link">Begin to build Docker Image</a></li><li><a href="#load-the-image-to-the-cluster-environment" class="table-of-contents__link">Load the image to the cluster environment</a></li></ul></li><li><a href="#install-apisix-ingress" class="table-of-contents__link">Install APISIX Ingress</a></li><li><a href="#create-httpbin-service-and-apisixroute-resources" class="table-of-contents__link">Create httpbin service and ApisixRoute resources</a><ul><li><a href="#create-httpbin-service" class="table-of-contents__link">Create httpbin service</a></li><li><a href="#create-apisixroute-resource" class="table-of-contents__link">Create ApisixRoute Resource</a></li></ul></li><li><a href="#test" class="table-of-contents__link">Test</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">ASF</div><ul class="footer__items"><li class="footer__item"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Foundation</a></li><li class="footer__item"><a href="https://www.apache.org/licenses/" target="_blank" rel="noopener noreferrer" class="footer__link-item">License</a></li><li class="footer__item"><a href="https://www.apache.org/events/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Events</a></li><li class="footer__item"><a href="https://www.apache.org/security/" target="_blank" rel="noopener noreferrer" class="footer__link-item">Security</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Sponsorship</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item">Thanks</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a href="https://github.com/apache/apisix/issues" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/docs/general/join">Slack</a></li><li class="footer__item"><a href="https://twitter.com/ApacheAPISIX" target="_blank" rel="noopener noreferrer" class="footer__link-item">Twitter</a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCgPD18cMhOg5rmPVnQhAC8g" target="_blank" rel="noopener noreferrer" class="footer__link-item">YouTube</a></li></ul></div><div class="col footer__col"><div class="footer__title">More</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/zh/blog/">Blog</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/showcase">Showcase</a></li><li class="footer__item"><a class="footer__link-item" href="/zh/plugins">Plugin Hub</a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.apache.org/" target="_blank" rel="noopener noreferrer" class="footerLogoLink_fkq+"><img src="https://static.apiseven.com/202202/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_3EHU themedImage--light_heW6 footer__logo"><img src="https://static.apiseven.com/202202/asf_logo_wide_small.png" alt="Apache Software Foundation" class="themedImage_3EHU themedImage--dark_6pZL footer__logo"></a></div><div class="footer__copyright">Copyright ¬© 2019-2022 The Apache Software Foundation. Apache APISIX, APISIX¬Æ, Apache, the Apache feather logo, and the Apache APISIX project logo are either registered trademarks or trademarks of the Apache Software Foundation.</div></div></div></footer></div>
<script src="https://apisix-website-static.apiseven.com/zh/assets/js/runtime~main.7eccae1e.js"></script>
<script src="https://apisix-website-static.apiseven.com/zh/assets/js/main.2db8c3d8.js"></script>
</body>
<script>window.onload=function(){window.location.host.endsWith(".netlify.app")&&document.querySelector("#__docusaurus").insertAdjacentHTML("afterend",'<div style="text-align: right;padding: 48px 32px 48px 0;">This site is powered by <a href="https://www.netlify.com/" target="_blank">Netlify</a></div>')}</script>
</html>